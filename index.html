<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sun Salutation 10950 </title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            color: #dddedd;
            font-family: 'Courier New', monospace;
            overflow-y: auto; /* Allow vertical scrolling */
            height: 100%;
        }
        
        .section {
            width: 100%;
            padding: 20px;
            box-sizing: border-box; /* Include padding in width calculation */
        }
        
        #layeredArtSection {
            position: relative;
        }

        .layered-art-container {
            position: relative;
            font-family: 'Courier New', monospace;
            white-space: pre;
        }

        .layered-art-container div {
            position: absolute;
            top: 0;
            left: 0;
        }

        #python-art {
            font-size: 0.6vw; /* 7px base */
            font-color: white;
        }

        #bday-art-overlay {
            font-size: 0.42vw; /* 5px base */
            /* Initial positioning guess */
            top: 50px; 
            left: 150px;
            color: rgb(246, 193, 4); /* Make it stand out */
            text-shadow: 0 0 5px #fafafa;
        }
        
        .side-by-side-container {
            display: flex;
            justify-content: space-between; /* Change to space-between */
            align-items: center;
            width: 100%;
        }

        .poem-container {
            flex-basis: 50%;
        }
        
        .typewriter-container {
            white-space: pre;
            font-size: 1vw; /* 12px base */
            line-height: 1.4;
            letter-spacing: 1px;
            text-align: left;
            max-width: 50%;
        }

        #poemSection .typewriter-container {
            text-align: left;
        }
        
        .later-sections {
            text-align: left;
            align-items: flex-start;
            justify-content: flex-start;
            padding: 20px;
        }
        
        .later-sections .typewriter-container {
            width: 100%;
            max-width: none;
        }
        
        .cursor {
            animation: blink 1s infinite;
            color: #ffffff;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .typewriter-text {
            color: #f9faf9;
            text-shadow: 0 0 5px #fafafa;
            font-size: 1.17vw; /* 14px base */
        }
        
        .typewriter-text.poem {
            font-size: 14px; /* User preference */
            color: rgb(243, 205, 11);
        }
        
        .typewriter-text.indras-net-art {
            font-size: 0.75vw; /* Adjusted for better fit */
            color: rgb(211, 75, 241);
            text-shadow: none;
        }

        .typewriter-text.heading {
            font-size: 0.83vw; /* 10px base */
            text-align: left;
        }

        .typewriter-text.birthday {
            font-size: 0.8vw; /* 8px base */
            text-align: left;
            margin-top: 20px;
            color: rgb(221, 3, 255);
        }
        
        .typewriter-text.python {
            font-size: 0.5vw; /* 6px base */
            text-align: left;
            margin-top: 20px;
        }

        .typewriter-text.exaltation-art {
            font-size: 0.8vw; /* 5px base */
            color: #FF69B4; /* Pink */
            text-shadow: 0 0 5px #FF69B4, 0 0 10px #FF69B4;
        }

        .typewriter-text.with-love-art {
            font-size: 0.4vw;
            color: #FFC0CB; /* Lighter Pink */
            text-shadow: 0 0 5px #FFC0CB;
        }

        .typewriter-text.messages-art {
            font-size: 1.0vw;
            color: #f8a101;
            text-shadow: 0 0 5px #ffffff;
            margin-top: 20px;
           
        }

        /* Subtle glow effect */
        /* .glow {
            text-shadow: 
                0 0 5px #00ff41,
                0 0 10px #00ff41,
                0 0 15px #00ff41;
        } */
        
        /* Continue button styling */
        .continue-button {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: transparent;
            border: 1px solid white;
            color: #f6f6f6;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.3);
        }
        
        .continue-button:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(-50%) scale(1.1);
            box-shadow: 0 6px 20px rgba(255, 255, 255, 0.4);
        }

        .spinning-art-container {
            width: 400px;
            height: 400px;
            border-radius: 50%;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: spin 20s linear infinite;
        }

        .spinning-art-container .ascii-art {
            color: white;
            font-size: 8px;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .continue-button.green {
            color: #ffffff;
            border-color: #ffffff;
        }

        .continue-button.pink {
            color: #FF69B4;
            border-color: #FF69B4;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Section 1: Saturn Poem & Spinning Art -->
        <div class="section" id="poemSection">
            <div class="side-by-side-container">
                <div class="typewriter-container poem-container">
                    <div class="typewriter-text poem" id="typewriter"></div>
                    <span class="cursor" id="cursor">_</span>
                </div>
                <div id="spinningArtContainerBesidePoem" style="display: none; flex-basis: 50%; justify-content: center; align-items: center;">
                    <div class="spinning-art-container">
                        <pre id="indrasNetArt" class="ascii-art"></pre>
                    </div>
                </div>
            </div>
            <button id="continueBtn" class="continue-button" style="display: none;">↓</button>
        </div>

        <!-- Section 2: Cristina Heading & Birthday Text -->
        <div class="section later-sections" id="headingSection">
            <div class="typewriter-container">
                <div class="typewriter-text heading" id="headingText"></div>
                <div class="typewriter-text birthday" id="birthdayText" style="margin-top: 20px;"></div>
                <div class="typewriter-text python" id="pythonText" style="margin-top: 20px;"></div>
            </div>
        </div>

        <!-- Section 3: Layered ASCII Art -->
        <div class="section later-sections" id="layeredArtSection">
            <div class="layered-art-container">
                <div id="python-art" class="python-base"></div>
                <div id="bday-art-overlay" class="bday-overlay"></div>
            </div>
            <button id="continueBtn2" class="continue-button green" style="display: none;">↓</button>
        </div>

        <!-- Section 5: Exaltation Art -->
        <div class="section later-sections" id="exaltationSection">
            <div class="typewriter-container">
                <div class="typewriter-text exaltation-art" id="exaltationText"></div>
                <div class="typewriter-text with-love-art" id="withLoveText" style="margin-top: 20px;"></div>
                <div class="typewriter-text messages-art" id="messagesText"></div>
            </div>
            <button id="continueBtn4" class="continue-button pink" style="display: none;">↓</button>
            <button id="continueBtn5" class="continue-button pink" style="display: none;">↓</button>
        </div>
    </div>

    <!-- Audio Elements -->
    <audio id="typing-sound" src="sounds/typing.wav" preload="auto"></audio>
    <audio id="alarm-sound" src="sounds/alarm.mp3" preload="auto"></audio>

    <script>
        const typewriter = document.getElementById('typewriter');
        const cursor = document.getElementById('cursor');
        const continueBtn = document.getElementById('continueBtn');
        const headingText = document.getElementById('headingText');
        const birthdayDiv = document.getElementById('birthdayText');
        const continueBtn2 = document.getElementById('continueBtn2');
        const continueBtn4 = document.getElementById('continueBtn4');
        const continueBtn5 = document.getElementById('continueBtn5');
        
        let currentPhase = 'saturn';
        let activeSkippers = [];

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                // Make a copy as skipper() can modify the array during iteration
                [...activeSkippers].forEach(skipper => skipper());
            }
        });
        
        /**
         * A reusable function to load ASCII art from a file and animate it.
         * @param {string} filePath - The path to the ASCII art text file.
         * @param {string} elementId - The ID of the element to display the art in.
         * @param {object} options - Configuration options.
         * @param {number} [options.lineDelay=200] - Delay between printing each line.
         * @param {boolean} [options.autoScroll=false] - Whether to scroll the view as content is added.
         * @param {string} [options.charAnimation='line'] - 'line' for line-by-line, 'char' for char-by-char.
         * @param {number} [options.charSpeed=25] - Speed for character-by-character animation.
         * @param {function} [options.onComplete=null] - Callback function when animation is done.
         */
        function loadAndAnimateAscii(url, elementId, options = {}) {
            const {
                charAnimation = 'line',
                charSpeed = 25,
                lineDelay = 200,
                onComplete,
                autoScroll = false
            } = options;
            
            const typewriterElement = document.getElementById(elementId);
            if (!typewriterElement) {
                console.error(`Element with ID "${elementId}" not found.`);
                return;
            }
            
            const cursor = typewriterElement.parentElement.querySelector('.cursor');

            if (cursor) {
                cursor.style.display = 'inline';
            }

            let timeoutId;
            let completed = false;
            let fullText = '';

            const skipper = () => {
                if (completed) return;
                completed = true;
                clearTimeout(timeoutId);

                if (charAnimation === 'char') {
                    typewriterElement.textContent = fullText;
                } else {
                    typewriterElement.innerHTML = fullText;
                }

                if (cursor) cursor.style.display = 'none';
                if (onComplete) onComplete();
                
                const index = activeSkippers.indexOf(skipper);
                if (index > -1) {
                    activeSkippers.splice(index, 1);
                }
            };

            activeSkippers.push(skipper);

            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.text();
                })
                .then(text => {
                    fullText = text;
                    typewriterElement.style.whiteSpace = 'pre';
                    
                    if (charAnimation === 'char') {
                        let charIndex = 0;
                        function type() {
                            if (completed) return;
                            if (charIndex < text.length) {
                                typewriterElement.textContent += text.charAt(charIndex);
                                if (autoScroll) {
                                    typewriterElement.scrollIntoView({ behavior: 'smooth', block: 'end' });
                                }
                                
                                // Play sound if specified
                                if (options.soundId) {
                                    const sound = document.getElementById(options.soundId);
                                    if (sound) {
                                        sound.currentTime = 0;
                                        sound.play().catch(e => {}); // Catch errors for autoplay policy
                                    }
                                }

                                charIndex++;
                                timeoutId = setTimeout(type, charSpeed);
                            } else {
                                if (cursor) cursor.style.display = 'none';
                                if (onComplete) onComplete();
                                completed = true;
                                const index = activeSkippers.indexOf(skipper);
                                if (index > -1) {
                                    activeSkippers.splice(index, 1);
                                }
                            }
                        }
                        type();
                    } else { // line-by-line
                        const lines = text.split('\n');
                        let lineIndex = 0;
                        function printLine() {
                            if (completed) return;
                            if (lineIndex < lines.length) {
                                typewriterElement.innerHTML += (lines[lineIndex] + '\n');
                                if (autoScroll) {
                                    typewriterElement.scrollIntoView({ behavior: 'smooth', block: 'end' });
                                }
                                lineIndex++;
                                timeoutId = setTimeout(printLine, lineDelay);
                            } else {
                                if (cursor) cursor.style.display = 'none';
                                if (onComplete) onComplete();
                                completed = true;
                                const index = activeSkippers.indexOf(skipper);
                                if (index > -1) {
                                    activeSkippers.splice(index, 1);
                                }
                            }
                        }
                        printLine();
                    }
                })
                .catch(error => {
                    console.error(`Error loading ASCII from ${url}:`, error);
                    typewriterElement.textContent = `Error: Could not load content from ${url}.`;
                });
        }

        /**
         * Loads ASCII art and flashes it on the screen.
         * @param {string} elementId - The ID of the element to display the art in.
         * @param {string} filePath - The path to the ASCII art text file.
         * @param {number} times - How many times to flash.
         * @param {function} onComplete - Callback function when animation is done.
         */
        async function flashAscii(elementId, filePath, times, onComplete) {
            const element = document.getElementById(elementId);
            const sound = document.getElementById('alarm-sound');

            try {
                if (sound) {
                    sound.loop = true;
                    sound.play().catch(e => {});
                }
                const response = await fetch(filePath);
                const text = await response.text();
                
                let timeoutId;
                let completed = false;

                const skipper = () => {
                    if (completed) return;
                    completed = true;
                    clearTimeout(timeoutId);
                    element.style.visibility = 'visible';
                    element.innerHTML = text;
                    if (onComplete) onComplete();
                    const index = activeSkippers.indexOf(skipper);
                    if (index > -1) {
                        activeSkippers.splice(index, 1);
                    }
                };
                activeSkippers.push(skipper);

                let flashCount = 0;
                const maxFlashes = times * 2; // on/off cycles

                function flash() {
                    if (completed) return;
                    if (flashCount < maxFlashes) {
                        element.style.visibility = (flashCount % 2 === 0) ? 'hidden' : 'visible';
                        if (flashCount === 1) element.innerHTML = text; // Set text on first visible flash
                        flashCount++;
                        timeoutId = setTimeout(flash, 300);
                    } else {
                        if (sound) sound.pause();
                        completed = true;
                        element.style.visibility = 'visible';
                        element.innerHTML = text; // Ensure it's visible at the end
                        if (onComplete) onComplete();
                        const index = activeSkippers.indexOf(skipper);
                        if (index > -1) {
                            activeSkippers.splice(index, 1);
                        }
                    }
                }
                flash();
            } catch (error) {
                console.error(`Error loading or flashing ASCII art from ${filePath}:`, error);
                element.textContent = `Error: Could not load content from ${filePath}.`;
            }
        }
        
        function showContinueButton() {
            cursor.style.display = 'none';
            continueBtn.style.display = 'block';
            continueBtn.addEventListener('click', function() {
                continueBtn.style.display = 'none';
                const headingSection = document.getElementById('headingSection');
                headingSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                // Wait for scroll to be noticeable before starting flash
                setTimeout(startCristinaFlash, 500);
            });
        }

        function showContinueButton2() {
            continueBtn2.style.display = 'block';
            continueBtn2.addEventListener('click', function() {
                continueBtn2.style.display = 'none';
                startExaltationArt();
            });
        }
        
        function showContinueButton4() {
            continueBtn4.style.display = 'block';
            continueBtn4.addEventListener('click', function() {
                continueBtn4.style.display = 'none';
                startWithLoveArt();
            });
        }

        function showContinueButton5() {
            continueBtn5.style.display = 'block';
            continueBtn5.addEventListener('click', function() {
                continueBtn5.style.display = 'none';
                startMessagesArt();
            });
        }

        function startCristinaFlash() {
            flashAscii('headingText', 'AsciiPieces/Cristina Heading.txt', 3, startLayeredArt);
        }
        
        function startBirthdayText() {
            loadAndAnimateAscii('AsciiPieces/30yoBby.txt', 'birthdayText', {
                charAnimation: 'line',
                lineDelay: 150,
                autoScroll: true,
                onComplete: startLayeredArt
            });
        }

        function startLayeredArt() {
            let animationsCompleted = 0;
            const totalAnimations = 2;

            function onAnimationComplete() {
                animationsCompleted++;
                if (animationsCompleted === totalAnimations) {
                    const artContainer = document.querySelector('.layered-art-container');
                    const pythonArt = document.getElementById('python-art');
                    artContainer.style.height = pythonArt.offsetHeight + 'px';
                    showContinueButton2();
                }
            }

            loadAndAnimateAscii('AsciiPieces/smolPython.txt', 'python-art', {
                charAnimation: 'line',
                lineDelay: 50,
                autoScroll: true,
                onComplete: onAnimationComplete
            });

            // Load the overlay art simultaneously
            loadAndAnimateAscii('AsciiPieces/30yoBby.txt', 'bday-art-overlay', {
                charAnimation: 'line',
                lineDelay: 50,
                autoScroll: true,
                onComplete: onAnimationComplete
            });
        }

        function startIndraNetNextToPoem() {
            const spinningArt = document.getElementById('spinningArtContainerBesidePoem');
            spinningArt.style.display = 'flex';
            loadAndAnimateAscii('AsciiPieces/indrasNet.txt', 'indrasNetArt', {
                charAnimation: 'line',
                lineDelay: 5,
                autoScroll: false,
                onComplete: showContinueButton
            });
        }

        function startExaltationArt() {
            loadAndAnimateAscii('AsciiPieces/ExaltationMeditationVocationExplorationRespiration.txt', 'exaltationText', {
                charAnimation: 'line',
                lineDelay: 100,
                autoScroll: true,
                onComplete: showContinueButton4
            });
        }

        function startWithLoveArt() {
            loadAndAnimateAscii('AsciiPieces/Withlove.txt', 'withLoveText', {
                charAnimation: 'line',
                lineDelay: 100,
                autoScroll: true,
                onComplete: showContinueButton5
            });
        }

        function startMessagesArt() {
            loadAndAnimateAscii('AsciiPieces/messages.txt', 'messagesText', {
                charAnimation: 'line',
                lineDelay: 150,
                autoScroll: true
            });
        }

        // Initial call to start the animation
        document.addEventListener('DOMContentLoaded', (event) => {
            window.scrollTo(0, 0);
            loadAndAnimateAscii('AsciiPieces/Saturn Returns Poem.txt', 'typewriter', {
                charAnimation: 'char',
                charSpeed: 25,
                autoScroll: true,
                soundId: 'typing-sound',
                onComplete: startIndraNetNextToPoem
            });
        });

    </script>
</body>
</html> 